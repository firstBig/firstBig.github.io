import{u as S,r as G,a as f,t as F,b as d,o as _,c as b,d as i,e as s,f as M,w as m,F as O,g as Q,_ as U,h as u,i as T,j as K}from"./index-BFD346K-.js";import{p as j,g as L}from"./request-DuKRqWk2.js";let v=(t,h)=>{let a=null,n="";return t.type=="number"&&(n=/^\d+$/,t.length&&(n=new RegExp("^\\d{"+t.length+"}$")),a=n.test(h)),a},$=t=>({username:t.username,password:t.password,code:Math.random()*10});const z=Object.freeze(Object.defineProperty({__proto__:null,login:$,reg:v,regular:v},Symbol.toStringTag,{value:"Module"})),A=t=>j("/login/qr/key",t),H=t=>j("/login/qr/create",t),J=t=>L("/login/qr/check",t),W={class:"page-layout"},X={class:"login-layout flex-r justify-c align-c p-20 border-r-6"},Y=i("div",{class:"tip"},[i("span",null,"忘记密码")],-1),Z={class:"other"},ee={class:"qr-box"},te=["src"],le={__name:"login",setup(t){const h=S();let a=G({username:"",password:"",code:"",remember:!0}),n=f(!1),y=f(!1),k=f(""),P=f(""),p=F(a,"username"),g=F(a,"password"),q=null;const x={username:[{trigger:"blur",required:!0,message:"Please input your username!"}],password:[{trigger:"blur",required:!0,message:"Please input your password!"}],code:[{validator:async(o,e)=>e?v({type:"number"},e)==!1?Promise.reject("Please input number"):v({type:"number",length:6},e)==!1?Promise.reject("code length is 6"):Promise.resolve():Promise.reject("Please input the code"),required:!0,trigger:"blur"}]},E=o=>{console.log("Success:",o),new Promise((e,c)=>{setTimeout(()=>{let r=Math.random()*10;console.log(r),e(r)},3e3)}).then(e=>new Promise((c,r)=>{e>4?setTimeout(()=>{c(!0)},2e3):setTimeout(()=>{r(!1)},2e3)})).then(e=>{e==!0?(console.log("成功"),U(()=>Promise.resolve().then(()=>z),void 0).then(c=>{let r=c.login({username:"admin",password:"admin@123"});console.log(r)})):console.log("失败"),console.log()})},R=o=>{console.log("Failed:",o)};let C=o=>{o==1?n.value=!1:(n.value=!0,w())},w=()=>{let o=new Date().getTime();A({timestamp:o}).then(e=>{k.value=e.data.unikey,V(e.data.unikey)}).catch(e=>{})},V=o=>{y.value=!1,H({key:o,qrimg:!0}).then(e=>{P.value=e.data.qrimg,q=setInterval(()=>{B()},3e3)})},B=()=>{n.value=!0;let o=new Date().getTime();J({key:k.value,timestamp:o}).then(e=>{e.code==800&&(clearInterval(q),y.value=!0),e.cookie&&(window.localStorage.setItem("cookie",e.cookie),h.push({name:"mine"}))}).catch(e=>{})};return(o,e)=>{const c=d("a-input"),r=d("a-form-item"),D=d("a-input-password"),I=d("a-button"),N=d("a-form");return _(),b("div",W,[i("div",X,[s(n)?(_(),b(O,{key:1},[i("span",{class:"type-1",onClick:e[4]||(e[4]=l=>s(C)(1))},"密码登录"),i("div",ee,[i("img",{src:s(P),alt:""},null,8,te),s(y)?(_(),b("span",{key:0,class:"btn-refresh",onClick:e[5]||(e[5]=(...l)=>s(w)&&s(w)(...l))},"刷新")):Q("",!0)])],64)):(_(),M(N,{key:0,class:"w-100",name:"basic",autocomplete:"off",model:s(a),"label-col":{span:5},"wrapper-col":{span:19},rules:x,onFinish:E,onFinishFailed:R},{default:m(()=>[u(r,{label:"用户名",name:"username"},{default:m(()=>[u(c,{value:s(p),"onUpdate:value":e[0]||(e[0]=l=>T(p)?p.value=l:p=l)},null,8,["value"])]),_:1}),u(r,{label:"密码",name:"password"},{default:m(()=>[u(D,{value:s(g),"onUpdate:value":e[1]||(e[1]=l=>T(g)?g.value=l:g=l)},null,8,["value"])]),_:1}),u(r,{label:"验证码",name:"code"},{default:m(()=>[u(c,{value:s(a).code,"onUpdate:value":e[2]||(e[2]=l=>s(a).code=l)},null,8,["value"])]),_:1}),u(r,{class:"item-login","wrapper-col":{span:24}},{default:m(()=>[u(I,{type:"primary","html-type":"submit",style:{margin:"0 auto"}},{default:m(()=>[K("登录")]),_:1}),Y,i("div",Z,[i("span",{onClick:e[3]||(e[3]=l=>s(C)(2))},"扫码登录")])]),_:1})]),_:1},8,["model"]))])])}}};export{le as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
